# This is the customization config file for your installation. Please
#   be careful in editing, otherwise the server may not start, or not behave the
#   way you want it to.                                                  fishfin

# SECTION 1: Global Customization Variables for the Installation ---------------
Define FF_LOGSDIR "c:/prod/logs"

# SRVROOT is where Apache is unzipped
Define SRVROOT "c:/prod/apache"
Define FF_HTDOCS "c:/prod/htdocs"
# If you are not sure, keep WEBROOT same as HTDOCS, but it need not be so
#Define FF_WEBROOT "${FF_HTDOCS}/ff/public_html"
Define FF_WEBROOT "${FF_HTDOCS}"
Define FF_HTTPPORT 80
Define FF_HTTPSPORT 443

Define FF_SYSTEMNAME "prodpcbhrfaq03"

Define FF_SERVERNAMEW3 "${FF_SYSTEMNAME}.w3-969.ibm.com"
# Where you have your SSL certificates. The CERT can be the same as CHAIN
Define FF_SSLCERTPEMW3 "c:/ssl/${FF_SERVERNAMEW3}.chain.pem"
Define FF_SSLKEYPEMW3 "c:/ssl/${FF_SERVERNAMEW3}.private-key.pem"
Define FF_SSLCERTCHAINPEMW3 "c:/ssl/${FF_SERVERNAMEW3}.chain.pem"

# Comment the following block out if you do not have an Internet interface
Define FF_SERVERNAMEWWW "${FF_SYSTEMNAME}.podc.sl.edst.ibm.com"
Define FF_SSLCERTPEMWWW "c:/ssl/${FF_SERVERNAMEWWW}.chain.pem"
Define FF_SSLKEYPEMWWW "c:/ssl/${FF_SERVERNAMEWWW}.private-key.pem"
Define FF_SSLCERTCHAINPEMWWW "c:/ssl/${FF_SERVERNAMEWWW}.chain.pem"

# Define one of FF_PHPDSOMODE and FF_PHPFCGIMODE, comment out the other
# DSO = Dynamic Shared Object, aka. LoadModule php5_module etc.
# Please be aware that in FCGI Mode, PHP Directives in .htaccess won't work
# When using DSO Mode, extension_dir is relative of Apache bin path, whereas
#   for FCGI it is relative path of PHP root directory. You will need to
#   have separate php.ini's just for that. I spent over 3 days to figure
#   this out, you needn't. :)
#Define FF_PHPDSOMODE
Define FF_PHPFCGIMODE

# The available PHP versions in respective dirs. Create a pattern so that the
# suffix is the version. For prefix, see next. You can add new versions,
# but please follow the same pattern for the variable name as well as the
# suffix.
Define FF_PHP_56 "56ts"
Define FF_PHP_71 "71ts"

# The dir where php resides. Put just the directory path + prefix, the suffix
# will be the actual PHP version (see FF_PHP_XX earlier)
Define FF_PHPDIR_PFX "c:/prod/php_"

# For DSOMODE, the following PHP will be actived; for FCGI mode, the following
#   PHP will be default
Define FF_PHP_DFLT "${FF_PHP_71}"
# Please customize .../custom/php/phpfcgi/php.ini for any php patameters
#   extension_dir can be relative to PHP for FCGI
# Please customize .../custom/php/phpdso/php.ini for DSOMODE
#   extension_dir must be absolute
Define FF_PHPINIDIR "c:/prod/custom/php/phpfcgi"

# Windows Environment PATH for FCGI
Define FF_ENVPATH_FCGID "C:/WINDOWS/system32;C:/WINDOWS;C:/WINDOWS/System32/Wbem;"

Define FF_SERVERADMIN "dtcops@in.ibm.com"

# If response generated by app doesn't have "Cache-Control: max-age=seconds" or
#   "Expiry: date" headers, then only these will be added 
Define FF_RESPONSEHDR_CACHECTRL_EXPIRESDEFAULT_SECS 3600

# Enable Server Info and Status by keeping SERVERINFO_BASEURL variable
# uncommented. If it is commented, other SERVERINFO_* are ignored.
# If allowing multiple, separate them by spaces
Define FF_SERVERINFO_BASEURL "srv"
Define FF_SERVERINFO_ALLOWDOMAIN "ibm.com"
Define FF_SERVERINFO_ALLOWIP "127 9 10"

# Uncomment the following if you want to allow resources from this server
#   being served for webpages hosted on another server
Define FF_ACCESSCONTROLALLOWORIGIN

# ** WARNING ** DO NOT MODIFY ANYTHING BEYOND THIS POINT
# SECTION 2: Macros ------------------------------------------------------------
<IfModule !macro_module>
  LoadModule macro_module modules/mod_macro.so
</IfModule>

<IfModule macro_module>
  <Macro FF_Include $FF_INCLUDE_FILE>
    Include "${FF_APACHECUSTOMDIR}/$FF_INCLUDE_FILE"
  </Macro>

  <Macro FF_LoadModule $FF_LOADMODULE_MODULENAME $FF_LOADMODULE_MODULEPATH>
    <IfModule !$FF_LOADMODULE_MODULENAME>
      <IfFile ${FF_APACHECUSTOMDIR}/$FF_LOADMODULE_MODULEPATH>
        LoadModule "$FF_LOADMODULE_MODULENAME" "${FF_APACHECUSTOMDIR}/$FF_LOADMODULE_MODULEPATH"
      </IfFile>
      <IfFile !${FF_APACHECUSTOMDIR}/$FF_LOADMODULE_MODULEPATH>
        <IfFile $FF_LOADMODULE_MODULEPATH>
          LoadModule "$FF_LOADMODULE_MODULENAME" "${SRVROOT}/$FF_LOADMODULE_MODULEPATH"
        </IfFile>
        <IfFile !$FF_LOADMODULE_MODULEPATH>
          Error "FFER001: Could not load module from ${FF_APACHECUSTOMDIR}/$FF_LOADMODULE_MODULEPATH \
or ${SRVROOT}/$FF_LOADMODULE_MODULEPATH or $FF_LOADMODULE_MODULEPATH. Download from \
apachelounge.com or apachehaus.com and make sure ${FF_APACHECUSTOMDIR}/$FF_LOADMODULE_MODULEPATH is valid."
        </IfFile>
      </IfFile>
    </IfModule>
  </Macro>

  <Macro FF_LoadModuleCheck $FF_LOADMODULE_MODULENAME>
    <IfModule !$FF_LOADMODULE_MODULENAME>
      Error "FFER002: $FF_LOADMODULE_MODULENAME not loaded, please uncomment 'LoadModule $FF_LOADMODULE_MODULENAME', or explicitly load."
    </IfModule>
  </Macro>

  <Macro FF_OPTIONS_DEFAULT>
	Use FF_OPTIONS "FollowSymLinks" "All" "all granted"
  </Macro>

  <Macro FF_OPTIONS $FF_OPTIONS_OPTIONS $FF_OPTIONS_ALLOWOVERRIDE $FF_OPTIONS_REQUIRE>
    Options $FF_OPTIONS_OPTIONS
    AllowOverride $FF_OPTIONS_ALLOWOVERRIDE
    Require $FF_OPTIONS_REQUIRE
  </Macro>
  
  <Macro FF_PHPFCGI_EnvSetup $FF_PHPFCGI_ENVSETUP_PHPVER>
    <IfDefine FF_PHPFCGIMODE>
      <IfModule fcgid_module>
        Options +ExecCGI
        AddHandler fcgid-script .php .php2 .php3 .php4 .php5 .phtml
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .php
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .php2
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .php3
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .php4
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .php5
        FcgidWrapper "${FF_PHPDIR_PFX}$FF_PHPFCGI_ENVSETUP_PHPVER/php-cgi.exe" .phtml
		FcgidInitialEnv PATH "C:/WINDOWS/system32;C:/WINDOWS;C:/WINDOWS/System32/Wbem;C:/prod/custom/bin/imagick_php$FF_PHPFCGI_ENVSETUP_PHPVER"
      </IfModule>
    </IfDefine>
  </Macro>

  <Macro FF_ServerInfo $FF_SERVERINFO_BASEURL $FF_SERVERINFO_ALLOWDOMAIN $FF_SERVERINFO_ALLOWIP>
    <IfModule !info_module>
      #fishfin: https://httpd.apache.org/docs/2.4/mod/mod_info.html
      #         Provides a comprehensive overview of the server configuration
      LoadModule info_module modules/mod_info.so
    </IfModule>
    <Location "/$FF_SERVERINFO_BASEURL/info">
      SetHandler server-info
      Require host localhost $FF_SERVERINFO_ALLOWDOMAIN
      Require ip 127 192 $FF_SERVERINFO_ALLOWIP
    </Location>
    <IfModule !status_module>
      # fishfin: https://httpd.apache.org/docs/2.4/mod/mod_status.html
      #          Provides information on server activity and performance
      LoadModule status_module modules/mod_status.so
    </IfModule>
    <Location "/$FF_SERVERINFO_BASEURL/status">
      SetHandler server-status
      Require host localhost $FF_SERVERINFO_ALLOWDOMAIN
      Require ip 127 192 $FF_SERVERINFO_ALLOWIP
    </Location>
    ExtendedStatus On
  </Macro>

  <Macro FF_VHostCommon>
    RewriteEngine On
    # Rewrite cannot be used at server level if vhosts exist
    RewriteCond "%{REQUEST_METHOD}" "^(TRACE|TRACK)"
    RewriteRule ".*" "-" [F]
  </Macro>

  <Macro FF_VHostSSLCert $FF_VHOSTSSLCERT_CERTPEM $FF_VHOSTSSLCERT_KEYPEM $FF_VHOSTSSLCERT_CHAINPEM>
    SSLEngine On
    SSLCertificateFile "$FF_VHOSTSSLCERT_CERTPEM"
    SSLCertificateKeyFile "$FF_VHOSTSSLCERT_KEYPEM"
    SSLCertificateChainFile "$FF_VHOSTSSLCERT_CHAINPEM"
  </Macro>

  <Macro FF_HTTPSRedirect $FF_HTTPSREDIRECT_LOCATION>
    RewriteEngine On
    RewriteCond "%{HTTPS}" "off" [NC]
    RewriteCond "%{REQUEST_URI}" "^$FF_HTTPSREDIRECT_LOCATION" [NC]
    RewriteRule "(.*)" "https://%{SERVER_NAME}:${FF_HTTPSPORT}%{REQUEST_URI}" [R=301,L]
  </Macro>
</IfModule>

# SECTION 3: Default VHOSTS ----------------------------------------------------
<VirtualHost *:${FF_HTTPPORT}>
  ServerName http.default.vhost
  Use FF_HTTPSRedirect "/"
  #Redirect 200 /
  #ErrorDocument 200 "%{SERVER_NAME} is not valid for this server."
</VirtualHost>

<VirtualHost *:${FF_HTTPSPORT}>
  ServerName https.default.vhost
  #Redirect 200 /
  #ErrorDocument 200 "%{SERVER_NAME} is not valid for this server."
  <IfDefine FF_SERVERNAMEWWW>
    Use FF_VHostSSLCert "${FF_SSLCERTPEMWWW}" "${FF_SSLKEYPEMWWW}" "${FF_SSLCERTCHAINPEMWWW}"
  </IfDefine>
  <IfDefine !FF_SERVERNAMEWWW>
    Use FF_VHostSSLCert "${FF_SSLCERTPEMW3}" "${FF_SSLKEYPEMW3}" "${FF_SSLCERTCHAINPEMW3}"
  </IfDefine>
</VirtualHost>
